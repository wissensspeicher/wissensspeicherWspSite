{% extends "base.html" %}
{% load webpages_extras %}

{% block results %}

<div id="searchfield" class="span12">
    <form action="/search/" id="mainsearch">
        <fieldset>
            <div class="controls">
                <input type="text" name="query" id="query" autofocus class="input-xxlarge search-query" value="{{ search_term }}">
                <button type="submit" title="Searching the Digital Knowledge Store" id="submit-button" class="btn">Search</button>
            </div>
            <div class="controls" id="searchoptions">
                <label for="translateCheck" class="checkbox inline">
                    <input type="checkbox" name="translateCheck" id="translateCheck"{% if translateSearch == True %} checked {% endif %}>Multilingual search <a href="#" style="font-size: .6em;">?</a>
                </label>
                <label for="morphologicalSearch" class="checkbox inline">
                    <input type="checkbox" name="morphologicalSearch" id="morphologicalSearch"{% if morphologicalSearch == True %} checked {% endif %}>Morphological search <a href="#" style="font-size: .6em;">?</a>
                </label>
            </div>
        </fieldset>
    </form>
</div>
<div id="summary" class="span12" style="margin-bottom: 20px">
    <p>{{ number_of_hits }} Treffer in {{ projectFacet|length }} Vorhaben/Projekten. Zeige Treffer {{ startTreffer }} – {{ endTreffer }}:</p>
</div>

<div id="results" class="row span7">
    <ol class="unstyled">
        {% for single_treffer in treffer %}
        <li class="search-result">
            <span id="hit{{ single_treffer.hitNumber }}">{{ single_treffer.hitNumber }}</span>
            <img class="format" src="../static/img/document-{{ single_treffer.type}}.png" alt="File format: {{ single_treffer.type}}" title="{{ single_treffer.type}}">
            {% if single_treffer.author %}
            <h3><a href="{{ single_treffer.url }}" title="{{ single_treffer.collectionName }}: {{ single_treffer.title}}">{{single_treffer.author|join:", "}}: {{ single_treffer.title}}</a></h3>
            {% else %}
            <h3><a href="{{ single_treffer.url }}" title="{{ single_treffer.collectionName }}: {{ single_treffer.title}}">{{ single_treffer.title }}</a></h3>
            {% endif %}
            {% if single_treffer.fragments %}
                {% for fragment in single_treffer.fragments %}<blockquote>{{ fragment|safe }}</blockquote>
                {% endfor %}
            {% endif %}

            <label class="zusatzClick">Weitere Informationen zu diesem Suchtreffer</label>
            <div class="metadata">
                <ul class="project inline">
                    <li><i class="icon-beaker" title="Vorhaben"></i></li>
                    <li><a href="{{single_treffer.collectionURL}}" title="Zur Homepage des Projekts"><b>{{ single_treffer.collectionName }}</b></a></li>
                    <li class="zusatz">{% with projektDaten=projektMetadaten|get_item:single_treffer.projectRdfURI %}{{ projektDaten.abstract}}{% endwith %}</li>
                    <li class="zusatz">{% with projektDaten=projektMetadaten|get_item:single_treffer.projectRdfURI %}(Status: {{ projektDaten.status}}){% endwith %}</li>
                </ul>
                {% if single_treffer.relevantPersons %}
                <ul class="persons inline zusatz">
                    <li style="margin-right:2px"><i class="icon-user" title="AutorInnen und weitere beteiligte Personen"></i></li>
                    {% for person in single_treffer.relevantPersons|slice:":8" %} {% if person.role != "editor" %}
                    <li><a href="{{ person.url }}" title="More about {{ person.name }}">{{ person.name }}</a></li>
                    {% endif %}{% endfor %}
                </ul>
                {% endif %}

                {% if single_treffer.places %}
                <ul class="places inline zusatz" title="Orte die mit dem Suchtreffer in Verbindung stehen">
                    <li><i class="icon-map-marker"></i></li>
                    {% for place in single_treffer.places|slice:":8" %}
                    <li>{{ place.place }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

        </li>
        {% endfor %}
    </ol>
<div id="pagination" class="text-center">

    <span class="step-links">
        {% if pagination.has_previous %}
            <a href="?query={{ search_term }}&amp;page={{ pagination.previous_page_number }}{{ query_parameters }}">&lt;</a>
        {% endif %}
        {% if show_first %}
        <span class="page"><a href="?page=1">1</a></span>
        <span class="ellipsis">...</span>
        {% endif %}

        <span class="current">
            Seite {{ pagination.number }} von {{ pagination.paginator.num_pages }}
        </span>

        {% if pagination.has_next %}
            <a href="?query={{ search_term }}&amp;page={{ pagination.next_page_number }}{{ query_parameters }}">&gt;</a>
        {% endif %}
    </span>
</div>
</div>

<div id="knowledge-browsing" class="row span5">
    <div id="eingrenzung">
        <form id="facetted-search" action="/search/">
            <input type="hidden" name="query" value="{{ search_term }}">
            <h2><!--<a class="statsPopup" href="#facetStats">-->Verteilung der Suchergebnisse<!--</a>--></h2>
            <fieldset>
                <legend>AutorInnen</legend>
                {% for single_author in authorFacet %}
                <label class="checkbox"><input type="checkbox" name="author" value="{{ single_author.name }}">{{ single_author.name }}: {{ single_author.count }} <span class="pie">{{ single_author.count }}/{{ number_of_hits }}</span></label>
                {% endfor %}
            </fieldset>
            <fieldset>
                <legend>Projekte/Vorhaben</legend>
                {% for single_project in projectFacet %}
                <label class="checkbox"><input type="checkbox" name="project" value="{{ single_project.projectShortname }}">{% with projektDaten=projektMetadaten|get_item:single_project.rdfURI %}{{ projektDaten.name}}{% endwith %}: {{ single_project.count }} <span class="pie">{{ single_project.count }}/{{ number_of_hits }}</span></label>
                {% endfor %}
            </fieldset>
            <fieldset>
                <legend>Sprachen</legend>
                {% for single_language in languageFacet %}
                <label class="checkbox"><input type="checkbox" name="language" value="{{ single_language.languageID }}">{{ single_language.language }}: {{ single_language.count }} <span class="pie">{{ single_language.count }}/{{ number_of_hits }}</span></label>
                {% endfor %}
            </fieldset>
            <fieldset>

                <button type="submit" title="Filter Search Results" id="filter-button" class="btn">Filter</button>
            </fieldset>
        </form>
    </div>
    <div id="sucherweiterung">
        <h2>Mögliche Erweiterungen der Suche</h2>
    </div>
    <div id="visualisierung">
        <h2>Visualisierung</h2>
        <!--<a href="#" id="zusatzZeigen">Details zu Suchergebnissen ein-/ausblenden</a>-->
        <img src="../static/img/tree-placeholder.png" class="img-rounded" alt="Placeholder">
    </div>

</div>
<div style="display:none">
    <div id="facetStats" style="padding:10px; background:#fff;">
        <h2>Verteilung der Suchergebnisse</h2>
        <div id="stats" style="width:500px; height:370px;"></div>
    </div>
</div>
</div>

{% endblock %}
